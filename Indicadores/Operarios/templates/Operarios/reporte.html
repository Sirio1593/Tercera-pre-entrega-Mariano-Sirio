{% extends "Operarios/base.html" %}
{% load static %}

        <title>Reportes-A1</title>

        {% block main %}


        <section id="about">
            <div class="container px-4">
                <div class="row gx-4 justify-content-center">
                    <div class="col-lg-8">
                        <h2>Reportes</h2>
        
                        <body>
                            <h1>Reportes de Cantidades producidas por Per√≠odos y por productos</h1>
                            <div class="product-buttons">
                                {% for product in products %}
                                    <button onclick="changeProduct('{{ product.nombre }}')">{{ product.nombre }}</button>
                                {% endfor %}
                            </div>
                            <canvas id="chart"></canvas>
                            <table>
                                <tr>
                                    <th>Year</th>
                                    <th>Month</th>
                                    <th>Product</th>
                                    <th>Total Quantity Produced</th>
                                </tr>
                                {% for period_product in quantities_per_period_and_product %}
                                <tr id="product-row-{{ period_product.productos_template__nombre }}">
                                    <td>{{ period_product.fecha_de_inicio__year }}</td>
                                    <td>{{ period_product.fecha_de_inicio__month }}</td>
                                    <td>{{ period_product.productos_template__nombre }}</td>
                                    <td>{{ period_product.total_cantidad_producida }}</td>
                                </tr>
                                {% endfor %}
                            </table>
                        </body>
                        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                        <script>
                            const quantities = [];
                            const products = [];
        
                            {% for period_product in quantities_per_period_and_product %}
                                quantities.push({{ period_product.total_cantidad_producida }});
                                products.push('{{ period_product.productos_template__nombre }}');
                            {% endfor %}
        
                            const ctx = document.getElementById('chart').getContext('2d');
                            const chart = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: products,
                                    datasets: [{
                                        label: 'Total Quantity Produced',
                                        data: quantities,
                                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                                        borderColor: 'rgba(54, 162, 235, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    }
                                }
                            });
        
                            function changeProduct(productName) {
                                // Hide all rows
                                const rows = document.querySelectorAll('tr[id^="product-row-"]');
                                rows.forEach(row => {
                                    row.style.display = 'none';
                                });
        
                                // Show selected product row
                                const selectedRow = document.querySelector(`#product-row-${productName}`);
                                if (selectedRow) {
                                    selectedRow.style.display = 'table-row';
                                }
        
                                // Update chart data
                                const productIndex = products.indexOf(productName);
                                if (productIndex !== -1) {
                                    const newData = quantities[productIndex];
                                    chart.data.datasets[0].data = [newData];
                                    chart.update();
                                }
                            }
                        </script>
                    </div>
                </div>
            </div>
        </section>
        

        {% endblock main %}